# 用户接入与指标指南 (User & Metrics Guide)

**面向对象**: 研发工程师、Tech Lead、产品经理、PMO
**版本**: 3.0.0
**日期**: 2025-12-16

---

## 1. 接入指南 (Onboarding Guide)

### 1.1 什么是 DevOps Data Collector?
这是一个自动化的效能数据采集平台，不需要您手动填报数据。只要您的项目在公司的 GitLab 上，且配置了 SonarQube，数据就会自动进入系统。

### 1.2 如何接入 GitLab 数据?
*   **自动发现**: 系统每天凌晨会自动扫描 GitLab 全量项目。
*   **归属确认**: 请确保您的 GitLab 项目位于正确的 **Group** 下。系统会根据 Group Description 自动将项目归属到对应的部门。

### 1.3 如何接入 SonarQube 数据?
为了让系统能自动关联 GitLab 代码库和 SonarQube 质量报告，请遵循以下命名规范：
*   **Sonar Project Key**: 必须与 GitLab 的 `Path with namespace` 一致（推荐将 `/` 替换为 `:`）。
    *   *GitLab*: `infra/devops-platform`
    *   *Sonar*: `infra:devops-platform`
*   如果无法遵循此规范，请联系管理员手动在数据库配置映射。

---

## 2. 指标词典与解读 (Metrics Dictionary)

### 2.1 交付效能 (Delivery - DORA)
*关注“快不快”和“稳不稳”*

#### 🚀 部署频率 (Deployment Frequency)
*   **定义**: 单位时间内成功部署到生产环境的次数。
*   **解读**: 越高越好。高频部署意味着更小的发布粒度 (`Small Batch Size`)，能降低风险。

#### ⏱️ 变更前置时间 (Lead Time for Changes)
*   **定义**: 从代码提交 (Commit) 到代码成功运行在生产环境 (Deployment) 的时间。
*   **解读**: 越短越好。如果时间过长，请检查 CR 是否积压、流水线是否缓慢。

### 2.2 代码质量 (Quality - SonarQube)
*关注“好不好”*

#### 🌡️ 技术债务 (Technical Debt / SQALE)
*   **定义**: 修复代码中所有可维护性问题所需的预估时间 (如 "5d" 代表 5天)。
*   **解读**: 持续上升是危险信号，意味着团队在“借高利贷”开发。

#### 🛡️ 代码覆盖率 (Code Coverage)
*   **定义**: 单元测试覆盖的代码行数比例。核心模块建议 >80%。

### 2.3 战略评估 (Strategy - PMO NEW)
*关注“值不值”*

#### 🧩 战略投资矩阵 (Strategic Portfolio Matrix)
我们将项目分为四个象限（X轴=开发速度，Y轴=代码质量）：
*   **🌟 明星 (Stars)**: 高速度 + 高质量。这是团队的核心资产，应**持续投入**。
*   **🐄 现金牛 (Cash Cows)**: 低速度 + 高质量。项目稳定，只需**日常维护**。
*   **🐕 瘦狗 (Dogs)**: 低速度 + 低质量。既跑不快又经常坏，建议**归档或重写**。
*   **🚑 问题儿童 (Problem Children)**: 高速度 + 低质量。团队在拼命开发，但背负了巨大债务。**急需重构**。

#### 💰 投入产出比 (ROI Efficiency)
*   **人均吞吐量 (Throughput per FTE)**: 平均每位全职人力交付的 MR 数量。
*   **需求成本 (Cost per Issue)**: 交付一个需求平均消耗的工时。

### 2.4 流程健康 (Governance & Process)
*关注“规不规”*

#### 🚨 流程违规率 (Direct Push Rate)
*   **定义**: 绕过代码评审 (MR) 直接 Push 到主分支的提交占比。
*   **红线**: 任何人不得高于 0%（特殊 Hotfix 除外）。这会破坏审计追踪。

#### 🤝 内源共创指数 (InnerSource Index)
*   **定义**: 跨部门贡献代码的比例。
*   **解读**: 我们鼓励“去改别人的代码”而不是“造轮子”。高指数代表良好的开放文化。

---

## 3. 如何提升我的指标？ (Actionable Advice)

### 3.1 想要提升“部署频率”？
*   **拆分需求**: 将大需求拆解为 2-3 天可交付的小 Story。
*   **自动化测试**: 提升单元测试覆盖率，让你敢于频繁发布。

### 3.2 想要减少“技术债务”？
*   **童子军军规**: 每次修改代码时，顺手清理一下旁边的“垃圾”（即重构）。
*   **Sonar 门禁**: 在 CI 流水线中开启 Sonar Quality Gate，阻断不达标代码合并。

### 3.3 想要成为“明星项目”？
*   **清理 Issue**: 及时关闭不再做的 Issue，激活陈旧分支。
*   **文档化**: 提升代码注释率，让新人也能快速上手（提升速度）。

---

## 4. 常见问题 (FAQ)

### Q: 为什么我的项目被标记为 "Problem Children"?
A: 这意味着您的项目虽然提交活跃（速度快），但 Bug 多或 Sonar 问题多（质量差）。建议安排专门的“技术债偿还周”。

### Q: "Shadow Satisfaction" (隐性满意度) 是怎么算的?
A: 我们分析 Issue 中的互动数据。如果一个 Bug 被反复 Reopen，或者评论区争吵激烈（评论数 > 10），系统会判定为“用户满意度低”。

### Q: 我是外部外包人员，没有公司邮箱怎么办?
A: 请联系管理员，将您的个人邮箱录入到 `users` 表，并标记为虚拟账号，即可归并数据。
