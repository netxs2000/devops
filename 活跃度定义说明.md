# 用户活跃度和项目活跃度定义说明

## 📊 概述

本文档详细说明了 DevOps 效能平台中**用户活跃度**和**项目活跃度**的定义、计算方法和分类标准。

---

## 👤 用户活跃度 (User Activity)

### 1. 定义依据

用户活跃度主要基于用户在 GitLab 中的**提交活动**（Commits）进行评估。

### 2. 核心指标

根据 `view_user_lifecycle.sql` 视图定义，用户活跃度包含以下核心指标：

| 指标 | 字段名 | 说明 |
|------|--------|------|
| **首次提交时间** | `first_commit_at` | 用户在系统中的第一次代码提交时间 |
| **最后提交时间** | `last_commit_at` | 用户在系统中的最近一次代码提交时间 |
| **活跃天数** | `active_days_count` | 从首次提交到最后提交的时间跨度（天数） |
| **活跃状态** | `status` | 基于最后提交时间的用户状态分类 |

### 3. 用户活跃状态分类

```sql
CASE 
    WHEN MAX(c.authored_date) < CURRENT_DATE - INTERVAL '90 days' THEN 'Churned'
    WHEN MAX(c.authored_date) < CURRENT_DATE - INTERVAL '30 days' THEN 'Dormant'
    ELSE 'Active'
END as status
```

| 状态 | 英文标识 | 定义条件 | 说明 |
|------|----------|----------|------|
| **活跃** | Active | 最后提交时间 ≥ 当前日期 - 30天 | 近30天内有代码提交活动 |
| **休眠** | Dormant | 30天 < 最后提交时间 < 90天 | 30-90天内未提交代码，但尚未流失 |
| **流失** | Churned | 最后提交时间 < 当前日期 - 90天 | 超过90天未提交代码，视为已流失 |

### 4. 用户贡献影响力评分

根据 `view_user_impact.sql` 视图，用户的综合贡献评分计算公式为：

```
contribution_score = (merged_mrs × 10) + (issues_created × 2) + (commits × 1)
```

**权重说明：**
- **合并的 MR（Merge Request）**: 权重 10 - 代表代码审查通过并合并，价值最高
- **创建的 Issue**: 权重 2 - 代表问题发现和需求提出能力
- **提交次数**: 权重 1 - 代表基础代码贡献

---

## 📦 项目活跃度 (Project Activity)

### 1. 定义依据

项目活跃度基于项目的**最后活动时间**（`last_activity_at`）进行评估。

### 2. 核心指标

根据 `view_project_value.sql` 视图定义，项目活跃度包含以下核心指标：

| 指标 | 字段名 | 说明 |
|------|--------|------|
| **最后活动时间** | `last_activity_at` | 项目最后一次有任何活动的时间 |
| **距今天数** | `days_since_last_activity` | 从最后活动时间到当前的天数 |
| **活跃状态** | `activity_status` | 基于最后活动时间的项目状态分类 |
| **提交总数** | `commit_count` | 项目的累计提交次数 |
| **价值评分** | `value_score` | 项目综合价值评分 |

### 3. 项目活跃状态分类

```sql
CASE 
    WHEN p.last_activity_at > CURRENT_DATE - INTERVAL '30 days' THEN 'Active'
    WHEN p.last_activity_at > CURRENT_DATE - INTERVAL '90 days' THEN 'Maintenance'
    WHEN p.last_activity_at > CURRENT_DATE - INTERVAL '365 days' THEN 'Dormant'
    ELSE 'Archived'
END as activity_status
```

| 状态 | 英文标识 | 定义条件 | 说明 |
|------|----------|----------|------|
| **活跃** | Active | 最后活动时间 ≥ 当前日期 - 30天 | 近30天内有活动，处于积极开发状态 |
| **维护** | Maintenance | 30天 < 最后活动时间 ≤ 90天 | 30-90天内有活动，处于维护状态 |
| **休眠** | Dormant | 90天 < 最后活动时间 ≤ 365天 | 90天-1年内有活动，但已较少维护 |
| **归档** | Archived | 最后活动时间 > 365天 | 超过1年未活动，视为已归档 |

### 4. 项目价值评分

根据 `view_project_value.sql` 视图，项目价值评分计算公式为：

```
value_score = (commit_count × 0.1) 
            + (tags_count × 50) 
            + (merged_mr_count × 10) 
            + activity_bonus
```

**权重说明：**
- **提交次数**: 权重 0.1 - 代表项目的代码积累
- **标签数量**: 权重 50 - 代表版本发布的成熟度
- **合并的 MR 数量**: 权重 10 - 代表协作和代码审查质量
- **活跃状态奖励**:
  - Active（活跃）: +100 分
  - Maintenance（维护）: +50 分
  - 其他状态: 0 分

---

## 📈 活跃度分析视图

系统提供了多个维度的活跃度分析视图（定义在 `activity_analysis.sql`）：

### 1. 时间维度分析

| 视图名称 | 分析维度 | 用途 |
|----------|----------|------|
| `view_activity_hour_of_week` | 周内小时热力图 | 分析一周7天×24小时的提交分布 |
| `view_activity_yearly` | 年度活跃度 | 分析近20年的年度提交趋势 |
| `view_activity_weekly` | 周活跃度 | 分析近32周的周提交趋势 |
| `view_activity_hour_of_day` | 日内小时分布 | 分析24小时内的提交分布和占比 |

### 2. 全局活跃度视图

- `view_activity_global_hour_of_week`: 全组织的周内小时热力图
- `view_activity_global_yearly`: 全组织的年度活跃度
- `view_activity_global_hour_of_day`: 全组织的日内小时分布

---

## 🏢 部门活跃度

根据 `dept_performance.sql` 视图，部门级别的活跃度指标包括：

### 1. 部门容量指标（`view_dept_capacity`）

- **人员数量**: `headcount` - 部门总人数
- **项目总数**: `project_count` - 部门管理的项目总数
- **活跃项目数**: `active_project_count` - 近30天内有活动的项目数量
- **总资产规模**: `total_asset_size` - 所有项目的存储空间总和

### 2. 部门活力评分（Vitality Score）

```
vitality_score = (active_project_count / project_count) × 100
```

**说明**: 活跃项目占总项目的百分比，反映部门项目的整体活跃程度。

---

## 🔍 关键时间阈值总结

| 维度 | Active（活跃） | Dormant/Maintenance（休眠/维护） | Churned/Archived（流失/归档） |
|------|----------------|----------------------------------|-------------------------------|
| **用户** | ≤ 30天 | 30-90天 | > 90天 |
| **项目** | ≤ 30天 | 30-90天（维护）<br>90-365天（休眠） | > 365天 |

---

## 📝 数据来源

所有活跃度指标的数据来源于以下核心表：

- **commits**: 提交记录表（包含 `authored_date`, `committed_date`）
- **projects**: 项目表（包含 `last_activity_at`）
- **users**: 用户表
- **merge_requests**: 合并请求表
- **issues**: 问题表

---

## 🎯 应用场景

### 用户活跃度应用
1. **人才保留**: 识别休眠和流失用户，及时干预
2. **绩效评估**: 基于贡献评分进行绩效考核
3. **团队健康度**: 监控团队整体活跃状态

### 项目活跃度应用
1. **资源优化**: 识别归档项目，回收资源
2. **项目优先级**: 根据活跃度和价值评分分配资源
3. **技术债务管理**: 关注休眠但重要的项目，避免技术债务积累

---

## 📌 注意事项

1. **时间基准**: 所有时间计算均基于 `CURRENT_DATE`（当前日期）
2. **数据库类型**: SQL 语法基于 PostgreSQL
3. **时区处理**: 确保所有时间字段使用统一时区
4. **定期更新**: 建议每日更新活跃度统计数据

---

*文档生成时间: 2025-12-14*  
*基于代码版本: devops_collector v2.0*
