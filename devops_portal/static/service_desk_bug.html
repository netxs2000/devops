<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提交缺陷 - Service Desk</title>
    <meta name="description" content="提交系统缺陷报告">
    <link href="css/main.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header class="u-p-24 u-w-full sd-header">
        <div class="u-flex u-flex-between u-mx-auto u-max-w-900">
            <div class="u-text-primary u-weight-700 u-text-h2">提交缺陷</div>
            <a href="service_desk.html" class="sd-nav-link">← 返回服务台</a>
        </div>
    </header>

    <main class="u-mx-auto u-p-40 u-max-w-900">
        <div class="u-text-center u-mb-40">
            <h1 class="u-text-primary u-mb-12 u-text-display">缺陷报告</h1>
            <p class="u-text-dim u-text-h3">请详细描述您遇到的问题，我们会尽快为您处理</p>
        </div>

        <div id="alertBox" class="alert"></div>

        <div class="g-card u-p-40">
            <div id="reporterSection" class="sd-reporter-info u-hide">
                <div class="sd-reporter-avatar u-flex u-flex-center" id="reporterAvatar">?</div>
                <div>
                    <div class="u-text-dim u-text-tiny u-uppercase u-ls-05">
                        报告人</div>
                    <div id="reporterName" class="u-weight-600 u-text-body">加载中...</div>
                </div>
            </div>

            <form id="bugForm">
                <div class="u-mb-24">
                    <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">受影响的业务系统 <span
                            class="u-text-error">*</span></label>
                    <select id="mdmId" class="form-control" required onchange="handleProjectChange()">
                        <option value="">正在加载项目列表...</option>
                    </select>
                    <div class="u-text-dim u-mt-8 u-text-caption">请选择发生故障的业务系统名称</div>
                </div>

                <div class="u-mb-24">
                    <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">缺陷标题 <span
                            class="u-text-error">*</span></label>
                    <input type="text" id="title" class="form-control" required placeholder="简要描述问题">
                </div>

                <div class="adm-grid-form u-mb-24">
                    <div>
                        <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">严重程度 <span
                                class="u-text-error">*</span></label>
                        <select id="severity" class="form-control" required>
                            <option value="">请选择</option>
                            <option value="S0">S0 - 致命（系统崩溃）</option>
                            <option value="S1">S1 - 严重（核心功能不可用）</option>
                            <option value="S2">S2 - 一般（功能受限）</option>
                            <option value="S3">S3 - 轻微（体验问题）</option>
                        </select>
                    </div>
                    <div>
                        <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">优先级 <span
                                class="u-text-error">*</span></label>
                        <select id="priority" class="form-control" required>
                            <option value="P0">P0 - 紧急</option>
                            <option value="P1">P1 - 高</option>
                            <option value="P2" selected>P2 - 中</option>
                            <option value="P3">P3 - 低</option>
                        </select>
                    </div>
                </div>

                <div class="adm-grid-form u-mb-24">
                    <div>
                        <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">省份/地域</label>
                        <input type="text" id="province" class="form-control" value="nationwide"
                            placeholder="例如：广东、nationwide">
                    </div>
                    <div>
                        <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">环境 <span
                                class="u-text-error">*</span></label>
                        <select id="environment" class="form-control" required>
                            <option value="">请选择</option>
                            <option value="production">生产环境</option>
                            <option value="staging">预发布环境</option>
                            <option value="test">测试环境</option>
                            <option value="development">开发环境</option>
                        </select>
                    </div>
                </div>

                <div class="u-mb-24">
                    <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">复现步骤 <span
                            class="u-text-error">*</span></label>
                    <textarea id="stepsToRepro" class="form-control u-h-120" required
                        placeholder="请详细描述如何重现该问题：&#10;1. 打开...&#10;2. 点击...&#10;3. 观察到..."></textarea>
                </div>

                <div class="u-mb-24">
                    <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">实际结果 <span
                            class="u-text-error">*</span></label>
                    <textarea id="actualResult" class="form-control u-h-100" required
                        placeholder="描述实际发生的情况"></textarea>
                </div>

                <div class="u-mb-24">
                    <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">期望结果 <span
                            class="u-text-error">*</span></label>
                    <textarea id="expectedResult" class="form-control u-h-100" required
                        placeholder="描述您期望的正确行为"></textarea>
                </div>

                <div class="u-mb-32">
                    <label class="u-text-dim u-weight-500 u-mb-8 u-block u-text-body">附件/截图证据</label>
                    <div id="uploadArea" class="sd-upload-area">
                        <div class="u-text-primary u-mb-10 u-text-h1">📁</div>
                        <div class="u-weight-600">点击或拖拽文件至此处上传</div>
                        <div class="u-text-dim u-mt-8 u-text-caption">支持图片、日志等，单个文件不超过 10MB</div>
                        <input type="file" id="fileInput" class="u-hide" multiple>
                    </div>
                    <div id="filePreview" class="g-grid-fill-120">
                    </div>
                </div>

                <button type="submit" class="btn-primary u-w-full u-p-16 u-text-h3" id="submitBtn">
                    提交缺陷报告
                </button>
            </form>
        </div>
    </main>

    <footer class="u-p-24 u-text-center u-text-dim sd-footer u-mt-48">
        <p>© 2025 TJHQ Service Desk</p>
    </footer>

    <!-- Scripts -->
    <script src="auth_utils.js"></script>
    <script src="js/modules/sd_portal.js" type="module"></script>
</body>

</html>

</html>