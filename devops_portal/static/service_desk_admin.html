<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台管理 - Service Desk</title>
    <link href="css/main.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import { AuthGuard } from './js/modules/auth_guard.js';
        AuthGuard.enforce('USER:MANAGE');
    </script>
</head>

<body>
    <header class="u-p-24 u-w-full sd-header">
        <div class="u-flex u-flex-between u-mx-auto u-max-w-1400">
            <div class="u-text-primary u-weight-700 u-text-h2">
                Service Desk <span class="sys-tag u-v-middle u-ml-8">Admin</span>
            </div>
            <div id="adminInfo"></div>
        </div>
    </header>

    <!-- Reject Modal -->
    <div id="rejectModal" class="modal-overlay u-hide">
        <div class="sys-auth-card u-max-w-500">
            <div class="auth-glass-panel">
                <div class="sys-auth-header u-mb-24">
                    <h3 class="sys-auth-title u-text-h2">拒绝注册申请</h3>
                    <p class="sys-auth-subtitle">请说明驳回的具体原因，将发送至用户邮箱</p>
                </div>

                <div class="u-mb-24">
                    <label class="u-label-caps u-mb-8 u-block">驳回理由 (Required)</label>
                    <textarea id="rejectReason" class="form-control u-h-120" placeholder="例如：信息不全、非本部门员工..."></textarea>
                    <input type="hidden" id="rejectEmail">
                </div>

                <div class="u-flex u-gap-12 u-flex-end">
                    <button class="btn-ghost u-p-10-20 u-radius-md js-btn-close-reject-modal">取消</button>
                    <button class="btn-primary u-bg-error u-p-10-20 u-radius-md js-btn-submit-reject">确认拒绝</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Approve Modal (New) -->
    <div id="approveModal" class="modal-overlay u-hide">
        <div class="sys-auth-card u-max-w-500">
            <div class="auth-glass-panel">
                <div class="sys-auth-header u-mb-24">
                    <h3 class="sys-auth-title u-text-h2">核准注册申请</h3>
                    <p class="sys-auth-subtitle">核准后用户即可登录平台，建议绑定 GitLab ID</p>
                </div>

                <div class="u-mb-24">
                    <label class="u-label-caps u-mb-8 u-block">GitLab User ID (Optional)</label>
                    <input type="text" id="approveGitlabId" class="form-control" placeholder="e.g. 556">
                    <input type="hidden" id="approveEmail">
                </div>

                <div class="u-flex u-gap-12 u-flex-end">
                    <button class="btn-ghost u-p-10-20 u-radius-md js-btn-close-approve-modal">取消</button>
                    <button class="btn-primary u-p-10-20 u-radius-md js-btn-submit-approve">确认通过</button>
                </div>
            </div>
        </div>
    </div>

    <main id="adminMain" class="u-mx-auto u-p-40 u-max-w-1400 u-hide">
        <div class="u-mb-32">
            <h1 class="u-text-primary u-text-display">用户管理</h1>
            <p class="u-text-dim u-text-h3">审核服务台用户的注册申请及管理权限</p>
        </div>

        <div class="sd-stats-grid u-mb-40" id="statsRow">
            <!-- Stats will be loaded here -->
        </div>

        <div class="sd-tabs u-mb-24">
            <div class="sd-tab is-active">待审批</div>
            <div class="sd-tab">正式用户</div>
            <div class="sd-tab">已拒绝</div>
            <div class="sd-tab">全部记录</div>
        </div>

        <div class="sd-admin-table-container">
            <table class="sd-table" id="userTable">
                <thead>
                    <tr>
                        <th>用户信息</th>
                        <th>公司/部门</th>
                        <th>注册时间</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- Users will be loaded here -->
                </tbody>
            </table>
        </div>
    </main>

    <footer class="u-p-24 u-text-center u-text-dim sd-footer u-mt-48">
        <p>© 2025 TJHQ</p>
    </footer>

    <template id="sd-stat-item-tpl">
        <div class="sd-stat-item">
            <div class="sd-stat-label js-stat-label"></div>
            <div class="sd-stat-value js-stat-value"></div>
        </div>
    </template>

    <template id="sd-user-row-tpl">
        <tr>
            <td class="u-p-16">
                <div class="u-flex-column">
                    <span class="u-weight-600 u-text-primary u-text-body js-user-name"></span>
                    <span class="u-text-dim u-text-caption js-user-email"></span>
                </div>
            </td>
            <td class="u-p-16 u-text-body js-user-company"></td>
            <td class="u-p-16 u-text-dim u-text-caption js-user-date"></td>
            <td class="u-p-16">
                <span class="sd-badge js-user-status-badge"></span>
                <div class="u-text-primary u-mt-4 u-weight-500 u-text-tiny js-user-gitlab-id"></div>
            </td>
            <td class="u-p-16 js-user-actions">
                <div class="u-flex u-gap-10 js-pending-actions u-hide">
                    <button class="btn-primary u-p-4 u-text-caption js-action-approve">通过</button>
                    <button class="btn-ghost u-p-4 u-text-caption u-text-error js-action-reject">拒绝</button>
                </div>
                <span class="u-text-dim u-text-caption js-processed-info u-hide"></span>
            </td>
        </tr>
    </template>

    <script src="js/modules/sd_admin.js" type="module"></script>
</body>

</html>