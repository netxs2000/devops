<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台管理 - Service Desk</title>
    <link href="css/main.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import { AuthGuard } from './js/modules/auth_guard.js';
        AuthGuard.enforce('USER:MANAGE');
    </script>
</head>

<body>
    <header class="u-p-24 u-w-full sd-header">
        <div class="u-flex u-flex-between u-mx-auto u-max-w-1400">
            <div class="u-text-primary u-weight-700 u-text-h2">
                Service Desk <span class="sys-tag u-v-middle u-ml-8">Admin</span>
            </div>
            <div id="adminInfo"></div>
        </div>
    </header>

    <!-- Reject Modal -->
    <div id="rejectModal" class="modal-overlay u-hide u-flex-center">
        <div class="modal u-max-w-500 g-card">
            <h3 class="u-mb-12 u-text-h3">拒绝注册申请</h3>
            <p class="u-text-dim u-mb-8 u-text-body">请说明拒绝原因：</p>
            <textarea id="rejectReason" class="form-control u-mb-20 u-h-100 u-w-full u-p-16 u-border-subtle u-radius-sm"
                placeholder="例如：不是目标用户、信息不全等..."></textarea>
            <input type="hidden" id="rejectEmail">
            <div class="u-flex u-gap-10 u-flex-end">
                <button class="btn-ghost js-btn-close-reject-modal u-p-8 u-pointer-cursor">取消</button>
                <button
                    class="btn-danger js-btn-submit-reject u-bg-error-light u-text-error u-p-8 u-radius-sm u-border-none u-pointer-cursor">确认拒绝</button>
            </div>
        </div>
    </div>

    <!-- Approve Modal (New) -->
    <div id="approveModal" class="modal-overlay u-hide u-flex-center">
        <div class="modal u-max-w-500 g-card">
            <h3 class="u-mb-12 u-text-h3">通过注册申请</h3>
            <p class="u-text-dim u-mb-8 u-text-body">请配置用户的 GitLab User ID (可选)：</p>
            <input type="text" id="approveGitlabId"
                class="form-control u-mb-20 u-w-full u-p-16 u-border-subtle u-radius-sm" placeholder="例如：123">
            <input type="hidden" id="approveEmail">
            <div class="u-flex u-gap-10 u-flex-end">
                <button class="btn-ghost js-btn-close-approve-modal u-p-8 u-pointer-cursor">取消</button>
                <button
                    class="btn-primary js-btn-submit-approve u-bg-primary-light u-text-primary u-p-8 u-radius-sm u-border-none u-pointer-cursor">确认通过</button>
            </div>
        </div>
    </div>

    <main id="adminMain" class="u-mx-auto u-p-40 u-max-w-1400 u-hide">
        <div class="u-mb-32">
            <h1 class="u-text-primary u-text-display">用户管理</h1>
            <p class="u-text-dim u-text-h3">审核服务台用户的注册申请及管理权限</p>
        </div>

        <div class="sd-stats-grid u-mb-40" id="statsRow">
            <!-- Stats will be loaded here -->
        </div>

        <div class="sd-tabs u-mb-24">
            <div class="sd-tab is-active">待审批</div>
            <div class="sd-tab">正式用户</div>
            <div class="sd-tab">已拒绝</div>
            <div class="sd-tab">全部记录</div>
        </div>

        <div class="sd-admin-table-container">
            <table class="sd-table" id="userTable">
                <thead>
                    <tr>
                        <th>用户信息</th>
                        <th>公司/部门</th>
                        <th>注册时间</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- Users will be loaded here -->
                </tbody>
            </table>
        </div>
    </main>

    <footer class="u-p-24 u-text-center u-text-dim sd-footer u-mt-48">
        <p>© 2025 TJHQ</p>
    </footer>

    <template id="sd-stat-item-tpl">
        <div class="sd-stat-item">
            <div class="sd-stat-label js-stat-label"></div>
            <div class="sd-stat-value js-stat-value"></div>
        </div>
    </template>

    <template id="sd-user-row-tpl">
        <tr>
            <td class="u-p-16">
                <div class="u-flex-column">
                    <span class="u-weight-600 u-text-primary u-text-body js-user-name"></span>
                    <span class="u-text-dim u-text-caption js-user-email"></span>
                </div>
            </td>
            <td class="u-p-16 u-text-body js-user-company"></td>
            <td class="u-p-16 u-text-dim u-text-caption js-user-date"></td>
            <td class="u-p-16">
                <span class="sd-badge js-user-status-badge"></span>
                <div class="u-text-primary u-mt-4 u-weight-500 u-text-tiny js-user-gitlab-id"></div>
            </td>
            <td class="u-p-16 js-user-actions">
                <div class="u-flex u-gap-10 js-pending-actions u-hide">
                    <button class="btn-primary u-p-4 u-text-caption js-action-approve">通过</button>
                    <button class="btn-ghost u-p-4 u-text-caption u-text-error js-action-reject">拒绝</button>
                </div>
                <span class="u-text-dim u-text-caption js-processed-info u-hide"></span>
            </td>
        </tr>
    </template>

    <script src="js/modules/sd_admin.js" type="module"></script>
</body>

</html>