# Service Desk åŠ¨æ€èº«ä»½å…³è”ä¸é‡æ„å®æ–½è®¡åˆ’

## ğŸ“‹ ä¼˜åŒ–ç›®æ ‡
æ¶ˆé™¤ä»£ç ä¸­ç¡¬ç¼–ç çš„ `user_id = 1`ï¼Œå»ºç«‹ Service Desk ç”¨æˆ·ä¸ GitLab æ“ä½œè€…èº«ä»½çš„åŠ¨æ€å…³è”æœºåˆ¶ï¼Œå®ç°çœŸå®çš„æ“ä½œå®¡è®¡ã€‚

---

## ğŸ¯ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: åç«¯æ¨¡å‹ä¸é€»è¾‘é‡æ„ (main.py)
1.  **å¢å¼ºç”¨æˆ·æ¨¡å‹**: åœ¨ `SERVICE_DESK_USERS` ä¸­å¢åŠ  `gitlab_user_id` å­—æ®µï¼Œé»˜è®¤ä¸º `None`ã€‚
2.  **å®ç°æ“ä½œè€…è·å–å‡½æ•°**: ç¼–å†™ `get_current_gitlab_user_id(token)`ï¼Œæ ¹æ® Session åŠ¨æ€è·å–å…³è”çš„ GitLab IDã€‚
3.  **é‡æ„ Issue åˆ›å»º/æ›´æ–°é€»è¾‘**: å°†æ‰€æœ‰ç¡¬ç¼–ç çš„ `1` æ›¿æ¢ä¸ºåŠ¨æ€è·å–çš„å€¼ã€‚
4.  **å¢å¼ºç®¡ç†å‘˜ API**: å…è®¸ç®¡ç†å‘˜åœ¨å®¡æ‰¹æ—¶æŒ‡å®šå…³è”çš„ GitLab ç”¨æˆ·ã€‚

### é˜¶æ®µ 2: å‰ç«¯é¡µé¢å¢å¼º
1.  **æ›´æ–°ç®¡ç†å‘˜é¡µé¢ (`service_desk_admin.html`)**: 
    - å®¡æ‰¹å¼¹çª—ä¸­å¢åŠ  "å…³è” GitLab User ID" è¾“å…¥æ¡†ã€‚
    - åˆ—è¡¨å±•ç¤ºç”¨æˆ·å…³è”çš„ GitLab IDã€‚
2.  **æ›´æ–°æˆ‘çš„å·¥å•é¡µé¢**: åœ¨æäº¤æˆ–æ“ä½œæ—¶å¸¦ä¸Šæ­£ç¡®çš„èº«ä»½ä¿¡æ¯ã€‚

---

## ğŸ”§ è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆ

### 1. åŠ¨æ€èº«ä»½è·å–é€»è¾‘
```python
def get_current_gitlab_user_id(token: str) -> int:
    """æ ¹æ® Service Desk Token è·å–å…³è”çš„ GitLab ç”¨æˆ· ID
    
    1. éªŒè¯ token æœ‰æ•ˆæ€§
    2. è·å–å¯¹åº”çš„ email
    3. åœ¨ SERVICE_DESK_USERS ä¸­æŸ¥æ‰¾å…³è”çš„ gitlab_user_id
    4. å¦‚æœæ²¡æœ‰å…³è”ï¼Œè¿”å›é»˜è®¤æœºå™¨äºº ID (1)
    """
    if token not in SESSION_TOKENS:
        return 1 # é»˜è®¤å›é€€åˆ°ç®¡ç†å‘˜
    
    email = SESSION_TOKENS[token]["email"]
    user_info = SERVICE_DESK_USERS.get(email, {})
    return user_info.get("gitlab_user_id") or 1
```

---

## ğŸ“Š è¿›åº¦è¡¨
| æ­¥éª¤ | å†…å®¹ | çŠ¶æ€ |
|------|------|------|
| 1.1 | å¢å¼ºæ•°æ®æ¨¡å‹ä¸è½½å…¥é€»è¾‘ | â³ å‡†å¤‡ä¸­ |
| 1.2 | é‡æ„æ ¸å¿ƒ API è°ƒç”¨çš„ user_id | â³ å‡†å¤‡ä¸­ |
| 2.1 | ç®¡ç†å‘˜é¡µé¢å¢åŠ å…³è”å­—æ®µ | â³ å‡†å¤‡ä¸­ |

---
**å¼€å§‹å®æ–½ï¼**
